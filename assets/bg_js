function notify(e){notification=Ti.App.iOS.scheduleLocalNotification({alertBody:e,alertAction:"OK",userInfo:{hello:"world"},badge:alertCount,date:new Date((new Date).getTime()+10)})}function checkWeekMed(){Ti.API.info("checkWeekMed!");var e=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/medications.xml");createFileIfNotExist(e);for(var t=e.read().text,i=Ti.XML.parseString(t),n=i.getElementsByTagName("medication"),a=[],o=0,r=new Date,d=0;n.length>d;d++){var s=n.item(d),l=new Date(s.getElementsByTagName("date").item(0).text);l.getTime()-r.getTime()>5184e5&&6048e5>=l.getTime()-r.getTime()&&(a[o++]="Medication "+s.getElementsByTagName("name").item(0).text+" Renewal on "+s.getElementsByTagName("date").item(0).text)}Ti.API.info(a.length);for(index in a)alertCount++,notify(a[index])}function checkDailyMed(){var e=new Date;if(8==e.getHours()){Ti.API.info("checkDailyMed!");var t=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/medications.xml");createFileIfNotExist(t);var i=t.read().text,n=Ti.XML.parseString(i),a=n.getElementsByTagName("medication"),o=[],r=0;Ti.API.info(a.length);for(var d=0;a.length>d;d++){var s=a.item(d);new Date(s.getElementsByTagName("date").item(0).text),o[r++]="Medication "+s.getElementsByTagName("name").item(0).text}Ti.API.info(o.length);for(index in o)alertCount++,notify(o[index])}}function checkDailyApp(){Ti.API.info("checkDailyApp!");var e=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/appointments.xml");createFileIfNotExist(e);for(var t=e.read().text,i=Ti.XML.parseString(t),n=i.getElementsByTagName("appointment"),a=[],o=0,r=new Date,d=0;n.length>d;d++){var s=n.item(d),l=new Date(s.date);l.getTime()-r.getTime()>0&&864e5>=l.getTime()-r.getTime()&&(a[o++]="Appointment on "+s.getElementsByTagName("name").item(0).text+" at "+s.getElementsByTagName("time").item(0).texte)}Ti.API.info(a.length);for(index in a)alertCount++,notify(a[index])}function createFileIfNotExist(e){e.exists()===!1&&(e.createFile(),e.write('<?xml version="1.0" encoding="UTF-8"?><info></info>'))}Ti.API.info("hello from a background service!");var alertCount=0,notification=null;Ti.App.iOS.addEventListener("notification",function(){Ti.App.currentService.stop(),Ti.App.currentService.unregister()});var timer1=setInterval(checkDailyApp,864e5),timer2=setInterval(checkDailyMed,36e5),timer3=setInterval(checkWeekMed,864e5);