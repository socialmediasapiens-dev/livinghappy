Ti.include("../functions.js"),Ti.include(root+"/lib/TiPreloader.js");var win=Ti.UI.currentWindow;designWindow(win,"Locations",Ti.App.userbg,!1),createTabGroup(win,1),showPreloader(win,"Loading..");for(var file=Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory,"/files/locations.xml"),xmltext=file.read().text,response=Ti.XML.parseString(xmltext),locationsArray=[],x=0,locations=response.getElementsByTagName("place"),i=0;locations.length>i;i++){var location=locations.item(i),locationArray=[];locationArray.name=location.getElementsByTagName("name").item(0).text,locationArray.street=location.getElementsByTagName("street").item(0).text,locationArray.city=location.getElementsByTagName("city").item(0).text,locationArray.state=location.getElementsByTagName("state").item(0).text,locationArray.zip=location.getElementsByTagName("zip").item(0).text,locationArray.phone=location.getElementsByTagName("phone").item(0).text,locationArray.lat=location.getElementsByTagName("lat").item(0).text,locationArray["long"]=location.getElementsByTagName("long").item(0).text,locationsArray[x++]=locationArray}var myLocation=[];Ti.Geolocation.purpose="Receive User Location",Ti.Geolocation.accuracy=Ti.Geolocation.ACCURACY_NEAREST_TEN_METERS,Ti.Geolocation.preferredProvider=Ti.Geolocation.PROVIDER_GPS,Ti.Geolocation.distanceFilter=10,Ti.Geolocation.getCurrentPosition(function(e){myLocation={latitude:e.coords.latitude,longitude:e.coords.longitude,latitudeDelta:.4,longitudeDelta:.4},"http://maps.google.com/maps?saddr="+myLocation.latitude+","+myLocation.longitude+"&daddr="+latitude+","+longitude;for(var t=[],i=0;locationsArray.length>i;i++){var a=locationsArray[i],n=Ti.Map.createAnnotation({latitude:a.lat,longitude:a["long"],title:a.name,subtitle:a.phone+" - Get Directions",image:root+"/images/map/pin-icon.png",animate:!0,rightButton:Ti.UI.iPhone.SystemButton.DISCLOSURE,myid:i});n.addEventListener("click",function(e){if("rightButton"==e.clicksource){var t="http://maps.google.com/maps?saddr="+myLocation.latitude+","+myLocation.longitude+"&daddr="+this.latitude+","+this.longitude;Ti.Platform.openURL(t)}}),t.push(n)}var o=Ti.Map.createView({mapType:Ti.Map.STANDARD_TYPE,region:{latitude:myLocation.latitude,longitude:myLocation.longitude,latitudeDelta:1,longitudeDelta:1},animate:!0,regionFit:!0,userLocation:!0,annotations:t,top:54,bottom:54,width:320,left:0});win.add(o);var r=Ti.UI.createView({width:320,bottom:60,height:61});win.add(r);var d=Ti.UI.createButton({backgroundImage:root+"/images/map/zoomin-icon.png",right:10,width:36,height:36});r.add(d);var l=Ti.UI.createButton({backgroundImage:root+"/images/map/zoomout-icon.png",left:10,width:36,height:36});r.add(l),d.addEventListener("click",function(){o.zoom(1)}),l.addEventListener("click",function(){o.zoom(-1)}),hidePreloader(win)});