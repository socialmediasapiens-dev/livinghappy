function createField(e,t,i,a,n,o){var r=Ti.UI.createView({width:300,height:80,top:e}),c=Ti.UI.createLabel({font:{fontSize:10},color:"#666666",text:t,top:0,height:20,left:0});r.add(c);var d=Ti.UI.createTextField({width:300,top:25,height:40,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,paddingLeft:5,paddingRight:5,value:o});if(r.add(d),0!=a){d.paddingLeft=35;var a=Ti.UI.createImageView({left:10,image:a});switch(d.add(a),i){case"date":a.width=23,a.height=25,d.enabled=!1}}if("number"==i&&(d.keyboardType=Ti.UI.KEYBOARD_NUMBER_PAD),0!=n&&("date"==i||"time"==i)){d.paddingRight=35;var n=Ti.UI.createImageView({right:10,image:n,width:13,height:8});d.add(n)}return r.input=d,r}function editMedication(e,t,i,a,n,o,r){var c='<?xml version="1.0" encoding="UTF-8"?><medications>',d=getMedicationsArray();for(var s in d){var l=d[s];c+="<medication>",c+="<id>"+l.id+"</id>",e==l.id?(c+="<name>"+t+"</name>",c+="<dosage>"+i+"</dosage>",c+="<usage>"+a+"</usage>",c+="<withmeals>"+n+"</withmeals>",c+="<date>"+o+"</date>",c+="<phone>"+r+"</phone>"):(c+="<name>"+l.name+"</name>",c+="<dosage>"+l.dosage+"</dosage>",c+="<usage>"+l.usage+"</usage>",c+="<withmeals>"+l.withmeals+"</withmeals>",c+="<date>"+l.date+"</date>",c+="<phone>"+l.phone+"</phone>"),c+="</medication>"}c+="</medications>";var m=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/medications.xml");createFileIfNotExist(m),m.write(c)}function getMedicationsArray(){var e=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/medications.xml");createFileIfNotExist(e);for(var t=e.read().text,i=Ti.XML.parseString(t),a=i.getElementsByTagName("medication"),n=[],o=[],r=0;a.length>r;r++){var c=a.item(r);n[r]={id:c.getElementsByTagName("id").item(0).text,name:c.getElementsByTagName("name").item(0).text,dosage:c.getElementsByTagName("dosage").item(0).text,usage:c.getElementsByTagName("usage").item(0).text,withmeals:c.getElementsByTagName("withmeals").item(0).text,date:c.getElementsByTagName("date").item(0).text,phone:c.getElementsByTagName("phone").item(0).text},o[r]=c.getElementsByTagName("name").item(0).text}var d;if("function"==typeof Object.keys)d=Object.keys(o);else for(var s in o)d.push(s);d.sort(function(e,t){return o[e].localeCompare(o[t])});var l=[];for(var m in d)l[m]=n[d[m]];return l}Ti.include("../functions.js");var win=Ti.UI.currentWindow;designWindow(win,"Edit Medication",!1,!0),win.backgroundColor="#EFEFEF",createTabGroup(win,0);var med=win.medication,id=med.id,name=med.name,dosage=med.dosage,usage=med.usage,withmeals=med.withmeals,date=med.date,phone=med.phone,scrollWrapper=Ti.UI.createScrollView({width:320,contentWidth:320,bottom:54});win.add(scrollWrapper);var nameLine=createField(60,"Name","text",!1,!1,name),dosageLine=createField(130,"Dosage","text",!1,!1,dosage),usageLine=createField(200,"Usage","text",!1,!1,usage),withLine=createField(270,"With Meals","text",!1,!1,withmeals),dateLine=createField(340,"Refil Date","date",root+"/images/appointments/date-icon.png",root+"/images/appointments/greenarrow.png",date),phoneLine=createField(410,"Pharmacy Phone","number",!1,!1,phone);scrollWrapper.add(nameLine),scrollWrapper.add(dosageLine),scrollWrapper.add(usageLine),scrollWrapper.add(withLine),scrollWrapper.add(dateLine),scrollWrapper.add(phoneLine);var saveButton=Ti.UI.createButton({width:130,height:41,backgroundImage:root+"/images/appointments/confirm-button.png",top:500,bottom:20});scrollWrapper.add(saveButton),saveButton.addEventListener("click",function(){""!=nameLine.input.value&&""!=dosageLine.input.value&&""!=usageLine.input.value&&""!=withLine.input.value&&""!=dateLine.input.value&&""!=phoneLine.input.value?(editMedication(id,nameLine.input.value,dosageLine.input.value,usageLine.input.value,withLine.input.value,dateLine.input.value,phoneLine.input.value),getAlert("Your new medication has been edited successfully"),win.close({animated:!0})):getAlert("All fields are required")});var datePicker=Ti.UI.createPicker({type:Ti.UI.PICKER_TYPE_DATE,bottom:-1e3,zIndex:9999999999,up:!1});win.add(datePicker),datePicker.addEventListener("change",function(){var e=datePicker.value,t=e.getMonth()+1;dateLine.input.value=t+"/"+e.getDate()+"/"+e.getFullYear()}),dateLine.input.addEventListener("click",function(){nameLine.input.blur(),dosageLine.input.blur(),usageLine.input.blur(),withLine.input.blur(),dateLine.input.blur(),phoneLine.input.blur(),0==datePicker.up?(datePicker.up=!0,datePicker.animate({bottom:0}),scrollWrapper.animate({top:-200})):(datePicker.up=!1,datePicker.animate({bottom:-1e3}),scrollWrapper.animate({top:0}))});