function createField(e,t,i,a,n,o){var r=Ti.UI.createView({width:300,height:80,top:e}),c=Ti.UI.createLabel({font:{fontSize:10},color:"#666666",text:t,top:0,height:20,left:0});r.add(c);var d=Ti.UI.createTextField({width:300,top:25,height:40,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,paddingLeft:5,paddingRight:5,value:o});if(r.add(d),0!=a){d.paddingLeft=35;var a=Ti.UI.createImageView({left:10,image:a});switch(d.add(a),i){case"date":a.width=23,a.height=25,d.enabled=!1;break;case"time":a.width=28,a.height=23,d.enabled=!1;break;case"location":a.width=20,a.height=27}}if(0!=n&&("date"==i||"time"==i)){d.paddingRight=35;var n=Ti.UI.createImageView({right:10,image:n,width:13,height:8});d.add(n)}return r.input=d,r}function blurall(){nameLine.input.blur(),locationLine.input.blur(),1==datePicker.up&&(datePicker.up=!1,datePicker.animate({bottom:-1e3})),1==timePicker.up&&(timePicker.up=!1,timePicker.animate({bottom:-1e3}),scrollWrapper.animate({top:0}))}function editAppointment(e,t,i,a,n){var o=win.appointmentsArray,r='<?xml version="1.0" encoding="UTF-8"?><appointments>',o=getAppointmentsArray();for(var c in o){var d=o[c];r+="<appointment>",r+="<id>"+d.id+"</id>",d.id==e?(r+="<name>"+t+"</name>",r+="<date>"+i+"</date>",r+="<time>"+a+"</time>",r+="<location>"+n+"</location>"):(r+="<name>"+d.name+"</name>",r+="<date>"+d.date+"</date>",r+="<time>"+d.time+"</time>",r+="<location>"+d.location+"</location>"),r+="</appointment>"}r+="</appointments>";var s=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/appointments.xml");createFileIfNotExist(s),s.write(r)}function getAppointmentsArray(){function e(e,t){return new Date(e.date).getTime()-new Date(t.date).getTime()}var t=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/appointments.xml");createFileIfNotExist(t);for(var i=t.read().text,a=Ti.XML.parseString(i),n=a.getElementsByTagName("appointment"),o=[],r=0;n.length>r;r++){var c=n.item(r);o[r]={id:c.getElementsByTagName("id").item(0).text,name:c.getElementsByTagName("name").item(0).text,date:c.getElementsByTagName("date").item(0).text,time:c.getElementsByTagName("time").item(0).text,location:c.getElementsByTagName("location").item(0).text}}return o.sort(e),o}Ti.include("../functions.js");var win=Ti.UI.currentWindow;designWindow(win,"Enter Appointment",!1,!0),win.backgroundColor="#EFEFEF",createTabGroup(win,0);var app=win.app,scrollWrapper=Ti.UI.createScrollView({width:320,contentWidth:320});win.add(scrollWrapper);var nameLine=createField(60,"Name of the person","text",!1,!1,app.name),dateLine=createField(130,"Date","date",root+"/images/appointments/date-icon.png",root+"/images/appointments/greenarrow.png",app.date),timeLine=createField(200,"Time","time",root+"/images/appointments/time-icon.png",root+"/images/appointments/greenarrow.png",app.time),locationLine=createField(270,"Location","location",root+"/images/appointments/location-icon.png",!1,app.location);scrollWrapper.add(nameLine),scrollWrapper.add(dateLine),scrollWrapper.add(timeLine),scrollWrapper.add(locationLine);var saveButton=Ti.UI.createButton({width:130,height:41,backgroundImage:root+"/images/appointments/confirm-button.png",top:350});scrollWrapper.add(saveButton),saveButton.addEventListener("click",function(){""!=nameLine.input.value&&""!=dateLine.input.value&&""!=timeLine.input.value&&""!=locationLine.input.value?(editAppointment(app.id,nameLine.input.value,dateLine.input.value,timeLine.input.value,locationLine.input.value),getAlert("Your new appointment has been edited successfully"),win.close({animated:!0})):getAlert("All fields are required")});var datePicker=Ti.UI.createPicker({type:Ti.UI.PICKER_TYPE_DATE,bottom:-1e3,zIndex:9999999999,up:!1});win.add(datePicker),datePicker.addEventListener("change",function(){var e=datePicker.value,t=e.getMonth()+1;dateLine.input.value=t+"/"+e.getDate()+"/"+e.getFullYear()});var timePicker=Ti.UI.createPicker({type:Ti.UI.PICKER_TYPE_TIME,bottom:-1e3,zIndex:9999999999,up:!1});win.add(timePicker),timePicker.addEventListener("change",function(){timeLine.input.value=timePicker.value.getHours()+":"+timePicker.value.getMinutes()}),dateLine.input.addEventListener("click",function(){nameLine.input.blur(),locationLine.input.blur(),1==timePicker.up&&(timePicker.up=!1,timePicker.animate({bottom:-1e3}),scrollWrapper.animate({top:0})),0==datePicker.up?(datePicker.up=!0,datePicker.animate({bottom:0})):(datePicker.up=!1,datePicker.animate({bottom:-1e3}))}),timeLine.input.addEventListener("click",function(){nameLine.input.blur(),locationLine.input.blur(),1==datePicker.up&&(datePicker.up=!1,datePicker.animate({bottom:-1e3})),0==timePicker.up?(blurall(),timePicker.up=!0,timePicker.animate({bottom:0}),scrollWrapper.animate({top:-50})):(timePicker.up=!1,timePicker.animate({bottom:-1e3}),scrollWrapper.animate({top:0}))}),nameLine.input.addEventListener("focus",function(){locationLine.input.blur(),1==datePicker.up&&(datePicker.up=!1,datePicker.animate({bottom:-1e3})),1==timePicker.up&&(timePicker.up=!1,timePicker.animate({bottom:-1e3}),scrollWrapper.animate({top:0}))}),locationLine.input.addEventListener("focus",function(){nameLine.input.blur(),1==datePicker.up&&(datePicker.up=!1,datePicker.animate({bottom:-1e3})),1==timePicker.up&&(timePicker.up=!1,timePicker.animate({bottom:-1e3}),scrollWrapper.animate({top:0}))});