function createLetterHeader(e){var t=Ti.UI.createTableViewRow({width:320,height:23,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,backgroundImage:root+"/images/contacts/lettergreen-background.png"}),i=Ti.UI.createLabel({left:28,height:20,font:{fontSize:12},color:"#FFFFFF",text:e,top:0});return t.add(i),t}function createMedicationLine(e,t,i,a,n,o,r){var c=Ti.UI.createTableViewRow({width:320,height:120,backgroundColor:"#FFFFFF",selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE}),d=Ti.UI.createView({width:320,height:30,top:0,backgroundColor:"#FFFFFF"});c.add(d);var l=createRowLabel("Medication Name",140,0,"#666666","bold"),s=createRowLabel("Dosage",50,140,"#666666","bold"),m=createRowLabel("Usage",140,180,"#666666","bold");d.add(l),d.add(s),d.add(m);var g=createSeperator(139),p=createSeperator(189);d.add(g),d.add(p);var u=Ti.UI.createView({width:322,height:30,top:30,backgroundColor:"#FDF8DA",borderColor:"#E2E2E2"});c.add(u);var h=createRowLabel(t,140,0,"#000000","normal"),w=createRowLabel(i,50,140,"#000000","normal"),T=createRowLabel(a,140,180,"#000000","normal");u.add(h),u.add(w),u.add(T);var b=createSeperator(140),f=createSeperator(190);u.add(b),u.add(f);var v=Ti.UI.createView({width:320,height:30,top:60,backgroundColor:"#FFFFFF"});c.add(v);var I=createRowLabel("With Meals",90,0,"#666666","bold"),y=createRowLabel("Refill Date",90,90,"#666666","bold"),F=createRowLabel("Pharmacy Phone",140,180,"#666666","bold");v.add(I),v.add(y),v.add(F);var U=createSeperator(89),k=createSeperator(179);v.add(U),v.add(k);var L=Ti.UI.createView({width:322,height:30,top:90,backgroundColor:"#FDF8DA",borderColor:"#E2E2E2"});c.add(L);var E=createRowLabel(n,90,0,"#000000","normal"),A=createRowLabel(o,90,90,"#000000","normal"),x=createRowLabel(r,140,180,"#000000","normal");L.add(E),L.add(A),L.add(x);var N=createSeperator(90),S=createSeperator(180);return L.add(N),L.add(S),c}function createTableSeperator(){var e=Ti.UI.createTableViewRow({width:320,height:5,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,backgroundColor:"transparent"});return e}function createRowLabel(e,t,i,a,n){var o=Ti.UI.createLabel({width:t,height:30,left:i,font:{fontSize:12,fontWeight:n},color:a,textAlign:"center",text:e});return o}function createSeperator(e){var t=Ti.UI.createView({width:1,height:30,backgroundColor:"#E2E2E2",left:e});return t}function getMedicationsArray(){var e=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/medications.xml");createFileIfNotExist(e);for(var t=e.read().text,i=Ti.XML.parseString(t),a=i.getElementsByTagName("medication"),n=[],o=[],r=0;a.length>r;r++){var c=a.item(r);n[r]={id:c.getElementsByTagName("id").item(0).text,name:c.getElementsByTagName("name").item(0).text,dosage:c.getElementsByTagName("dosage").item(0).text,usage:c.getElementsByTagName("usage").item(0).text,withmeals:c.getElementsByTagName("withmeals").item(0).text,date:c.getElementsByTagName("date").item(0).text,phone:c.getElementsByTagName("phone").item(0).text},o[r]=c.getElementsByTagName("name").item(0).text}var d;if("function"==typeof Object.keys)d=Object.keys(o);else for(var l in o)d.push(l);d.sort(function(e,t){return o[e].localeCompare(o[t])});var s=[];for(var m in d)s[m]=n[d[m]];return s}function getMedicationTableData(e){var t="A",i=[],a=0,n=0;for(var o in e){var r=e[o].id,c=e[o].name,d=e[o].dosage,l=e[o].usage,s=e[o].withmeals,m=e[o].date,g=e[o].phone,p=createTableSeperator();if(c.substring(0,1).toUpperCase()!=t||0==n){i[a++]=p;var u=createLetterHeader(c.substring(0,1).toUpperCase());t=c.substring(0,1).toUpperCase(),i[a++]=u}var h=createMedicationLine(r,c,d,l,s,m,g),w=Ti.UI.createTableViewRow({backgroundImage:root+"/images/common/greed-edit-bar.png",width:320,height:23,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,id:r,med:e[o]});w.addEventListener("click",function(){var e=Ti.UI.createWindow({url:root+"/subwindows/editmed.js",medication:this.med});Ti.UI.currentTab.open(e)}),i[a++]=h,i[a++]=w,i[a++]=p,n++}return i}Ti.include("../functions.js");var win=Ti.UI.currentWindow;designWindow(win,"Medications",Ti.App.userbg,!0),createTabGroup(win,0);var medicationsArrayOrdered=getMedicationsArray(),data=getMedicationTableData(medicationsArrayOrdered),medicationsTable=Ti.UI.createTableView({width:320,height:"auto",separatorStyle:Ti.UI.iPhone.TableViewSeparatorStyle.NONE,separatorColor:"transparent",backgroundColor:"transparent",data:data,bottom:50,top:52,showVerticalScrollIndicator:!1});if(win.add(medicationsTable),0==medicationsTable.data.length){var addwin=Ti.UI.createWindow({url:root+"/subwindows/newmed.js",medicationsArrayOrdered:medicationsArrayOrdered});Ti.UI.currentTab.open(addwin)}win.addEventListener("focus",function(){medicationsArrayOrdered=getMedicationsArray(),medicationsTable.setData(getMedicationTableData(medicationsArrayOrdered),{animationStyle:Ti.UI.iPhone.RowAnimationStyle.BOTTOM})});var addwrapper=Ti.UI.createView({height:52,width:55,right:0,zIndex:999999,top:0});win.add(addwrapper);var addButton=Ti.UI.createButton({backgroundImage:root+"/images/contacts/add-plus-icon.png",width:13,height:13,right:10});addwrapper.add(addButton);var addLabel=Ti.UI.createLabel({color:"#27A805",font:{fontSize:16},text:"Add",left:0});addwrapper.add(addLabel),addwrapper.addEventListener("click",function(){var e=Ti.UI.createWindow({url:root+"/subwindows/newmed.js",medicationsArrayOrdered:medicationsArrayOrdered});Ti.UI.currentTab.open(e)});