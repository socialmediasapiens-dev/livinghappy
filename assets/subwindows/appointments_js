function createAppRow(e,t){var i=new Date,o=new Date(e),n=root+"/images/appointments/greenbox-done.png";o.getTime()-i.getTime()>0&&(n=root+"/images/appointments/redbox-notdone.png");var a=Ti.UI.createTableViewRow({width:320,height:47,backgroundImage:n,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,rightImage:root+"/images/appointments/arrow-down.png",selected:!1,pos:t}),r=Ti.UI.createLabel({text:""+o.getDate(),font:{fontSize:20,fontWeight:"bold"},color:"#FFFFFF",left:10,width:30,height:47,textAlign:"center"});a.add(r);var s=Ti.UI.createView({width:1,height:45,backgroundColor:"#EFEFEF",left:50});a.add(s);var c=Ti.UI.createLabel({text:months[""+o.getMonth()]+" "+(""+o.getFullYear())+", "+days[""+o.getDay()],font:{fontSize:14,fontWeight:"bold"},color:"#FFFFFF",left:60,width:"auto",height:47});a.add(c);var l=[],d=0;for(t in appointmentsArray){var g=appointmentsArray[t];if(g.date==e){var p=createAppDetailsRow(g);l[d++]=p}}var m=Ti.UI.createTableViewRow({width:320,height:Ti.UI.SIZE,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE}),u=Ti.UI.createTableView({width:320,height:Ti.UI.SIZE,separatorStyle:Ti.UI.iPhone.TableViewSeparatorStyle.NONE,separatorColor:"transparent",backgroundColor:"transparent",data:l});return m.add(u),a.details=m,a.dateNum=r,a.monthLabel=c,a.bg1=n,a.addEventListener("click",function(e){0==this.selected?(appTable.insertRowAfter(e.index,this.details),this.rightImage=root+"/images/appointments/arrow.png",this.selected=!0,this.dateNum.color="purple",this.monthLabel.color="purple",this.backgroundImage="",this.backgroundColor="#FFFFFF"):(appTable.deleteRow(this.details),this.rightImage=root+"/images/appointments/arrow-down.png",this.selected=!1,this.dateNum.color="#FFFFFF",this.monthLabel.color="#FFFFFF",this.backgroundImage=this.bg1,this.backgroundColor="")}),a}function createAppDetailsRow(e){var t=Ti.UI.createTableViewRow({width:320,height:40,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,backgroundColor:"#EFEFEF"}),i=Ti.UI.createImageView({width:16,height:13,image:root+"/images/appointments/clock-icon.png",left:10});t.add(i);var o=Ti.UI.createLabel({width:"auto",left:30,text:e.time,font:{fontSize:14,fontWeight:"bold"},color:"#333333"});t.add(o);var n=Ti.UI.createView({left:90,width:2,height:40,backgroundColor:"#DEDEDE"});t.add(n);var a=Ti.UI.createLabel({width:200,right:10,text:"With "+e.name+". Location: "+e.location+".",font:{fontSize:12},color:"#333333"});t.add(a);var r=Ti.UI.createImageView({width:8,height:13,image:root+"/images/contacts/arrow-trasnparent.png",right:10,app:e});return t.add(r),r.addEventListener("click",function(){var e=Ti.UI.createWindow({url:root+"/subwindows/editapp.js",app:this.app});Ti.UI.currentTab.open(e)}),t}function getAppointmentsArray(){function e(e,t){return new Date(e.date).getTime()-new Date(t.date).getTime()}var t=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"/appointments.xml");createFileIfNotExist(t);for(var i=t.read().text,o=Ti.XML.parseString(i),n=o.getElementsByTagName("appointment"),a=[],r=0;n.length>r;r++){var s=n.item(r);a[r]={id:s.getElementsByTagName("id").item(0).text,name:s.getElementsByTagName("name").item(0).text,date:s.getElementsByTagName("date").item(0).text,time:s.getElementsByTagName("time").item(0).text,location:s.getElementsByTagName("location").item(0).text}}return a.sort(e),a}function getAppointmentTableData(e){var t=[],i=0,o=[];for(index in e)o.push(e[index].date);o=array_unique(o);for(index in o){var n=o[index],a=createAppRow(n,i+1);t[i++]=a}return t}function array_unique(e){var t,i,o,n=[],a=e.length;for(i=0;a>i;i++){for(t=void 0,o=0;n.length>o;o++)if(e[i]===n[o]){t=!0;break}t||n.push(e[i])}return n}Ti.include("../functions.js");var win=Ti.UI.currentWindow;designWindow(win,"Appointments",Ti.App.userbg,!0),createTabGroup(win,0);var appointmentButton=Ti.UI.createButton({width:248,height:49,backgroundImage:root+"/images/reminders/enterappointment-button.png",top:60});win.add(appointmentButton);var days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months=["January","February","March","April","May","June","July","August","September","October","November","December"],appointmentsArray=getAppointmentsArray(),data=getAppointmentTableData(appointmentsArray),appTable=Ti.UI.createTableView({width:320,height:"auto",separatorStyle:Ti.UI.iPhone.TableViewSeparatorStyle.NONE,separatorColor:"transparent",backgroundColor:"transparent",data:data,bottom:50,top:120,showVerticalScrollIndicator:!1});if(win.add(appTable),0==appTable.data.length){var winnew=Ti.UI.createWindow({url:root+"/subwindows/newapp.js",appointmentsArray:appointmentsArray});Ti.UI.currentTab.open(winnew)}win.addEventListener("focus",function(){appointmentsArray=getAppointmentsArray(),appTable.setData(getAppointmentTableData(appointmentsArray),{animationStyle:Ti.UI.iPhone.RowAnimationStyle.BOTTOM})}),appointmentButton.addEventListener("click",function(){var e=Ti.UI.createWindow({url:root+"/subwindows/newapp.js",appointmentsArray:appointmentsArray});Ti.UI.currentTab.open(e)});